<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INIT QR Code Distribution Portal</title>
    <style>
        :root {
            /* Updated Colors for INIT Theme */
            --color-background: #f4f6f8;
            --color-text: #1e293b;
            --color-text-secondary: #64748b;
            --color-primary: #2563eb; /* Blue */
            --color-primary-hover: #1d4ed8;
            --color-border: #cbd5e1;
            --color-error: #ef4444;
            --color-success: #10b981;
            --radius-base: 8px;
            --radius-lg: 16px;
            --space-20: 20px;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-background);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-20);
        }

        .container { max-width: 480px; width: 100%; }

        .card {
            background: #ffffff;
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-md);
            text-align: center;
        }

        .logo-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .logo-row img { height: 60px; width: auto; object-fit: contain; }

        h1 { font-size: 24px; font-weight: 700; margin-bottom: 8px; color: var(--color-text); }
        
        .subtitle { color: var(--color-text-secondary); font-size: 14px; margin-bottom: 32px; line-height: 1.5; }

        .form-group { margin-bottom: 20px; text-align: left; }
        
        label { display: block; font-weight: 600; font-size: 13px; margin-bottom: 8px; color: var(--color-text); text-transform: uppercase; letter-spacing: 0.5px; }

        select, input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: 16px;
            background: #fff;
            transition: 0.2s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 10px;
        }

        .btn:hover { background: var(--color-primary-hover); transform: translateY(-1px); }
        .btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }

        .message {
            padding: 12px;
            border-radius: var(--radius-base);
            margin-top: 20px;
            font-size: 14px;
            display: none;
            text-align: left;
        }
        .message.error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .message.success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }

        .loading { display: none; margin-top: 20px; }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* QR Code Preview Area */
        .qr-preview {
            margin-top: 24px;
            padding: 20px;
            background: #f8fafc;
            border: 2px dashed var(--color-border);
            border-radius: var(--radius-base);
            display: none;
        }
        .qr-preview.show { display: block; }
        
        .qr-preview img {
            width: 200px;
            height: 200px;
            margin-bottom: 16px;
            border-radius: 4px;
            background: white;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .download-btn {
            display: inline-block;
            text-decoration: none;
            background: var(--color-success);
            color: white;
            padding: 10px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
        }
        .download-btn:hover { background: #059669; }

        @media (max-width: 480px) {
            .card { padding: 24px 20px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="logo-row">
            <img src="logo-nobg.png" alt="INIT Logo">
        </div>
        
        <h1>INIT QR Portal</h1>
        <p class="subtitle">Select your Wing and enter your Roll Number to retrieve your unique QR Code.</p>

        <form id="qrForm">
            <div class="form-group">
                <label for="eventSelect">Select your wing</label>
                <select id="eventSelect" required>
                    <option value="">Select</option>
                    <option value="PR">PR</option>
                    <option value="Multimedia">Multimedia</option>
                    <option value="Logistics">Logistics</option>
                    <option value="Event Management">Event Management</option>
                    <option value="Research">Research</option>
                    <option value="Website">Website</option>
                    <option value="Github">Github</option>

                    
                </select>
            </div>

            <div class="form-group" id="rollGroup" style="display:none;">
                <label for="rollNumber">Roll Number</label>
                <input 
                    type="text" 
                    id="rollNumber" 
                    autocomplete="off"
                >
            </div>

            <button type="submit" class="btn" id="submitBtn">Find QR Code</button>
        </form>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="font-size: 13px; color: var(--color-text-secondary); margin-top: 10px;">Searching database...</p>
        </div>

        <div class="message" id="message"></div>

        <div class="qr-preview" id="qrPreview">
            <img id="qrImage" src="" alt="QR Code">
            <br>
            <a href="#" class="download-btn" id="downloadBtn" download>Download QR</a>
        </div>
    </div>
</div>

<script>
    // Configuration
    // If your images are .jpg, change this to '.jpg'
    const FILE_EXTENSION = '.png'; 
    
    // The base folder where you store event folders
    // Example structure: root/assets/hackathon/ROLL.png
    const BASE_PATH = './assets/'; 

    const form = document.getElementById('qrForm');
    const eventSelect = document.getElementById('eventSelect');
    const rollGroup = document.getElementById('rollGroup');
    const rollInput = document.getElementById('rollNumber');
    const submitBtn = document.getElementById('submitBtn');
    const loading = document.getElementById('loading');
    const message = document.getElementById('message');
    const qrPreview = document.getElementById('qrPreview');
    const qrImage = document.getElementById('qrImage');
    const downloadBtn = document.getElementById('downloadBtn');

    // UI Helpers
    const ui = {
        showMsg: (text, type) => {
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
        },
        hideMsg: () => {
            message.style.display = 'none';
        },
        toggleLoading: (show) => {
            loading.style.display = show ? 'block' : 'none';
            submitBtn.disabled = show;
        },
        showQR: (url, fileName) => {
            qrImage.src = url;
            downloadBtn.href = url;
            // Force download filename
            downloadBtn.setAttribute('download', fileName); 
            qrPreview.classList.add('show');
        },
        hideQR: () => {
            qrPreview.classList.remove('show');
            qrImage.src = '';
        }
    };

    // Show Roll Number input only when event is selected
    eventSelect.addEventListener('change', () => {
        rollGroup.style.display = eventSelect.value ? 'block' : 'none';
        if(eventSelect.value) rollInput.focus();
    });

    // Auto-capitalize Roll Number
    rollInput.addEventListener('input', (e) => {
        e.target.value = e.target.value.toUpperCase().trim();
    });

    // Main Form Submit
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Reset UI
        ui.hideMsg();
        ui.hideQR();

        const eventFolder = eventSelect.value;
        const rollNumber = rollInput.value;

        // Validation
        if (!eventFolder) return ui.showMsg('Please select an event.', 'error');
        if (rollNumber.length < 5) return ui.showMsg('Please enter a valid Roll Number.', 'error');

        ui.toggleLoading(true);

        // Construct the expected URL
        // Example: ./assets/hackathon/CB.EN.U4CYS22001.png
        const filePath = `${BASE_PATH}${eventFolder}/${rollNumber}${FILE_EXTENSION}`;

        try {
            // Check if file exists using fetch API
            const response = await fetch(filePath, { method: 'HEAD' });

            if (response.ok) {
                // Success
                ui.showMsg('QR Code found!', 'success');
                ui.showQR(filePath, `QR_${rollNumber}${FILE_EXTENSION}`);
            } else {
                // 404 Not Found
                throw new Error('QR Code not found.');
            }
        } catch (error) {
            console.error(error);
            ui.showMsg(`No QR Code found for roll number "${rollNumber}". Please verify your inputs or contact the coordinator.`, 'error');
        } finally {
            ui.toggleLoading(false);
        }
    });
</script>

</body>
</html>